<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pro.owner">

<select id="menuAttr1" resultType="AttrJoinDto">
SELECT T2.RK,T1.ATTR,CODE,T2.STARS 
FROM ATTRS T1,(SELECT RANK() OVER(ORDER BY AVG(STAR) DESC) AS RK, ATTR,AVG(STAR) AS STARS FROM TASTE WHERE TYPE='2주재료' GROUP BY ATTR) T2 
WHERE T1.ATTR=T2.ATTR AND RK=1 ORDER BY RK ASC
</select>

<select id="menuAttr2" resultType="AttrJoinDto">
SELECT T2.RK,T1.ATTR,CODE,T2.STARS 
FROM ATTRS T1,(SELECT RANK() OVER(ORDER BY AVG(STAR) DESC) AS RK, ATTR,AVG(STAR) AS STARS FROM TASTE WHERE TYPE='3조리방식' GROUP BY ATTR) T2 
WHERE T1.ATTR=T2.ATTR AND RK=1 ORDER BY RK ASC
</select>

<select id="menuAttr3" resultType="AttrJoinDto">
SELECT T2.RK,T1.ATTR,CODE,T2.STARS 
FROM ATTRS T1,(SELECT RANK() OVER(ORDER BY AVG(STAR) DESC) AS RK, ATTR,AVG(STAR) AS STARS FROM TASTE WHERE TYPE='4매움정도' GROUP BY ATTR) T2 
WHERE T1.ATTR=T2.ATTR AND RK=1 ORDER BY RK ASC
</select>
<select id="menuAttr4" resultType="AttrJoinDto">
SELECT T2.RK,T1.ATTR,CODE,T2.STARS 
FROM ATTRS T1,(SELECT RANK() OVER(ORDER BY AVG(STAR) DESC) AS RK, ATTR,AVG(STAR) AS STARS FROM TASTE WHERE TYPE='5온도' GROUP BY ATTR) T2 
WHERE T1.ATTR=T2.ATTR AND RK=1 ORDER BY RK ASC
</select>

<select id="MenuSearch" parameterType="String" resultType="menuDto">
SELECT SEQ,NAME,CODE,RES_SEQ,PRICE FROM MENULIST WHERE CODE=#{code}
</select>

<update id="ownerMyInfo" parameterType="Map">
	UPDATE ADMIN_OWNER SET PW=#{pw},PHONE=#{phone}, EMAIL=#{email} WHERE SEQ=#{seq}
</update>

<select id="selectResPhoto" parameterType="String" resultType="PhotoDto">
SELECT SEQ,ORIGIN,"CHANGE",RES_SEQ,MENU_SEQ FROM PHOTO WHERE RES_SEQ=#{res_seq}
</select>

<select id="selectResMenuDto" parameterType="String" resultType="menuDto">
SELECT SEQ,NAME,CODE,RES_SEQ,PRICE FROM MENULIST WHERE RES_SEQ=#{res_seq}
</select>

<delete id="delMenu" parameterType="String">
	DELETE FROM MENULIST WHERE SEQ=#{seq}
</delete>

<delete id="delPhoto" parameterType="String">
	DELETE FROM PHOTO WHERE MENU_SEQ=#{seq}
</delete>

<update id="updateMenu" parameterType="String">
	UPDATE FROM MENU SET NAME=#{name},CODE={#code} WHERE SEQ=#{seq}
</update>

<update id="updatePhoto" parameterType="String">
	UPDATE FROM MENU SET ORIGIN=#{origin},CHANGE={#change} WHERE MENU_SEQ=#{manu_seq}
</update>

<insert id="insertMenu" parameterType="Map">
	INSERT INTO MENULIST VALUES(MENULIST_SEQ.NEXTVAL,#{name},#{code},#{res_seq},#{price})
</insert>

<insert id="insertPhoto" parameterType="Map">
	INSERT INTO PHOTO VALUES(PHOTO_SEQ.NEXTVAL,#{origin},#{change},#{res_seq},#{menu_seq})
</insert>

</mapper>